<html>
<head>
<title>A/V Remote Control</title>
<link href="{{ url_for('static', filename='remote.css') }}" rel="stylesheet" type="text/css">
<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>

</head>
<body>
<table>
<tr>
<td>
<div class="range-slider">
<input id="volume-slider" class="input-range" orient="vertical" type="range" step="1" value="25" min="1" max="100">
</div>
</td>
<td>
<center>
<button id="mute_button">Mute</button><br>
<button id="video_power">LCDs On</button><br>
<hr>
<button id="mode_fm_button">FM Radio</button><br>
<button id="mode_cast_button">ChromeCast Video</button><br>
<button id="mode_castaudio_button">ChromeCast Audio</button><br>
<button id="mode_table_button">Table HDMI</button><br>
</center>
</td>
</tr>
</table>

<script type="text/javascript">

<!--
'use strict';

var volume_slider = $('#volume-slider');
var mute_button = $("#mute_button");

function set_interface_from_status(status)
{
    volume_slider.val(status['volume']);
    var is_muted = !(status['muting'] === 'off');
    mute_button.html(is_muted ? "Unmute" : "Mute");
}

function set_param(thing, value)
{
    $.ajax({
        type:"PUT",
        beforeSend: function (request)
        {
            //request.setRequestHeader("Authority", authorizationToken);
            request.setRequestHeader("Content-type","application/json");
            request.setRequestHeader("Accept","application/json");
        },
        url: /* APP.event_base_url + */ "set/" + thing,
        data: JSON.stringify({'value': value}),
        processData: false,
        success: function(data, status, xhr) {
            var av_status = JSON.parse(data);

            set_interface_from_status(av_status);
        }
    });
}

function update_status()
{
    $.ajax({
        type:"GET",
        beforeSend: function (request)
        {
            //request.setRequestHeader("Authority", authorizationToken);
            request.setRequestHeader("Content-type","application/json");
            request.setRequestHeader("Accept","application/json");
        },
        url: /* APP.event_base_url + */ "status",
        processData: false,
        success: function(data, status, xhr) {
            var av_status = JSON.parse(data);

            set_interface_from_status(av_status);
        }
    });
}
    
volume_slider.on('input', function(){
    console.log("set volume " + this.value);
    set_param('volume', this.value);
});

mute_button.on('click', function(){
    var is_muting = !(mute_button.html() === "Mute");
    var want_muting = !is_muting
    console.log("set muting " + want_muting);
    set_param('muting', want_muting ? "on" : "off")
});

var startup_status_json = '{{ startup_status|safe }}';

var startup_status = JSON.parse(startup_status_json);

set_interface_from_status(startup_status);

setInterval(update_status, 1000);

// -->
</script>

</body>
</html>
